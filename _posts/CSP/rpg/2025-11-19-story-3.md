---
layout: post
title: Story, Plot & Purpose Tutorial
description: Teach the fundamentals of creating a compelling RPG narrative.
permalink: /rpg/story
comments: True
---

<style>
/* RPG Navigation Sidebar Styles */
.rpg-nav-sidebar {
  position: fixed;
  left: 0;
  top: 0;
  height: 100vh;
  width: 280px;
  background: linear-gradient(145deg, rgba(20, 20, 40, 0.98), rgba(10, 10, 20, 0.98));
  backdrop-filter: blur(10px);
  box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
  transform: translateX(-280px);
  transition: transform 0.3s ease;
  z-index: 1000;
  border-right: 2px solid rgba(255, 215, 0, 0.3);
}

.rpg-nav-sidebar.open {
  transform: translateX(0);
}

.nav-toggle {
  position: absolute;
  right: -50px;
  top: 20px;
  width: 50px;
  height: 50px;
  background: linear-gradient(145deg, rgba(20, 20, 40, 0.98), rgba(10, 10, 20, 0.98));
  border: 2px solid rgba(255, 215, 0, 0.3);
  border-left: none;
  border-radius: 0 10px 10px 0;
  color: #ffd700;
  font-size: 24px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.nav-toggle:hover {
  background: rgba(255, 215, 0, 0.1);
  box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
}

.nav-content {
  padding: 30px 20px;
  height: 100%;
  overflow-y: auto;
}

.nav-title {
  color: #ffd700;
  font-size: 1.5em;
  font-family: 'Cinzel', 'Georgia', serif;
  text-align: center;
  margin-bottom: 10px;
  text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

.nav-divider {
  height: 2px;
  background: linear-gradient(90deg, transparent, #ffd700, transparent);
  margin-bottom: 20px;
}

.nav-links {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.nav-link {
  display: flex;
  align-items: center;
  padding: 15px;
  background: rgba(0, 0, 0, 0.3);
  border: 2px solid rgba(255, 215, 0, 0.2);
  border-radius: 10px;
  color: #c0c0c0;
  text-decoration: none;
  transition: all 0.3s ease;
  position: relative;
}

.nav-link:hover:not(.locked) {
  background: rgba(255, 215, 0, 0.1);
  border-color: #ffd700;
  transform: translateX(5px);
}

.nav-link.active {
  background: rgba(255, 215, 0, 0.15);
  border-color: #ffd700;
  box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
}

.nav-link.visited .nav-check {
  display: inline;
}

.nav-link.locked {
  opacity: 0.5;
  cursor: not-allowed;
  pointer-events: none;
}

.nav-link.locked .nav-lock {
  display: inline;
}

.nav-link:not(.locked) .nav-lock {
  display: none;
}

.nav-number {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 30px;
  height: 30px;
  background: rgba(255, 215, 0, 0.2);
  border-radius: 50%;
  color: #ffd700;
  font-weight: bold;
  margin-right: 12px;
  flex-shrink: 0;
}

.nav-text {
  flex: 1;
  font-size: 0.95em;
}

.nav-check {
  color: #4cc9f0;
  font-size: 1.2em;
  display: none;
  margin-left: 8px;
}

.nav-lock {
  color: #ff6b6b;
  font-size: 1em;
  margin-left: 8px;
}

@media (max-width: 768px) {
  .rpg-nav-sidebar {
    width: 240px;
    transform: translateX(-240px);
  }
}
</style>

<!-- RPG Navigation Sidebar -->
<div id="rpg-nav-sidebar" class="rpg-nav-sidebar">
  <button id="nav-toggle" class="nav-toggle">‚ò∞</button>
  <div class="nav-content">
    <h3 class="nav-title">üéÆ RPG Creator</h3>
    <div class="nav-divider"></div>
    <nav class="nav-links">
      <a href="/rpg/login" class="nav-link" data-page="1">
        <span class="nav-number">1</span>
        <span class="nav-text">Login</span>
      </a>
      <a href="/rpg/mode" class="nav-link" data-page="2">
        <span class="nav-number">2</span>
        <span class="nav-text">Game Mode</span>
        <span class="nav-check">‚úì</span>
      </a>
      <a href="/rpg/story" class="nav-link active" data-page="3">
        <span class="nav-number">3</span>
        <span class="nav-text">Story & Narrative</span>
        <span class="nav-check">‚úì</span>
      </a>
      <a href="/rpg/character-creation" class="nav-link" data-page="4">
        <span class="nav-number">4</span>
        <span class="nav-text">Character Creation</span>
        <span class="nav-check">‚úì</span>
      </a>
      <a href="/rpg/controls" class="nav-link" data-page="5">
        <span class="nav-number">5</span>
        <span class="nav-text">Controls</span>
        <span class="nav-check">‚úì</span>
      </a>
      <a href="/rpg/review" class="nav-link locked" data-page="6" id="review-link">
        <span class="nav-number">6</span>
        <span class="nav-text">Review</span>
        <span class="nav-lock">üîí</span>
        <span class="nav-check">‚úì</span>
      </a>
    </nav>
  </div>
</div>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Cinzel', 'Georgia', serif;
    background: #1a1a2e;
    min-height: 100vh;
    height: auto;
    position: relative;
    overflow-x: hidden;
    overflow-y: auto;
    padding: 40px 20px;
}

/* Animated background particles */
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
        radial-gradient(2px 2px at 20% 30%, white, transparent),
        radial-gradient(2px 2px at 60% 70%, white, transparent),
        radial-gradient(1px 1px at 50% 50%, white, transparent),
        radial-gradient(1px 1px at 80% 10%, white, transparent),
        radial-gradient(2px 2px at 90% 60%, white, transparent);
    background-size: 200% 200%;
    animation: stars 20s linear infinite;
    opacity: 0.3;
    z-index: 0;
}

@keyframes stars {
    from { transform: translate(0, 0); }
    to { transform: translate(-50%, -50%); }
}

.container {
    position: relative;
    z-index: 10;
    max-width: 1200px;
    margin: 0 auto;
}

.header-card {
    background: linear-gradient(145deg, rgba(30, 30, 60, 0.95), rgba(20, 20, 40, 0.95));
    border-radius: 20px;
    padding: 40px;
    box-shadow: 
        0 8px 32px 0 rgba(0, 0, 0, 0.7),
        inset 0 0 20px rgba(255, 215, 0, 0.1),
        0 0 40px rgba(255, 215, 0, 0.2);
    border: 2px solid rgba(255, 215, 0, 0.3);
    backdrop-filter: blur(10px);
    text-align: center;
    margin-bottom: 40px;
}

.title-icon {
    font-size: 4em;
    margin-bottom: 20px;
    filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
}

.main-title {
    color: #ffd700;
    font-size: 3em;
    margin-bottom: 15px;
    text-shadow: 
        0 0 10px rgba(255, 215, 0, 0.5),
        0 0 20px rgba(255, 215, 0, 0.3),
        2px 2px 4px rgba(0, 0, 0, 0.8);
    letter-spacing: 3px;
}

.subtitle {
    color: #c0c0c0;
    font-size: 1.2em;
    font-style: italic;
    opacity: 0.9;
}

.content-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 30px;
    margin-bottom: 40px;
}

.section-card {
    background: linear-gradient(145deg, rgba(30, 30, 60, 0.95), rgba(20, 20, 40, 0.95));
    border-radius: 20px;
    padding: 30px;
    box-shadow: 
        0 8px 32px 0 rgba(0, 0, 0, 0.7),
        inset 0 0 20px rgba(255, 215, 0, 0.1);
    border: 2px solid rgba(255, 215, 0, 0.3);
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
}

.section-card:hover {
    transform: translateY(-5px);
    box-shadow: 
        0 12px 40px 0 rgba(0, 0, 0, 0.8),
        inset 0 0 30px rgba(255, 215, 0, 0.2),
        0 0 60px rgba(255, 215, 0, 0.3);
}

.section-icon {
    font-size: 2.5em;
    margin-bottom: 15px;
    display: block;
}

.section-title {
    color: #ffd700;
    font-size: 1.8em;
    margin-bottom: 15px;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
}

.section-content {
    color: #e0e0e0;
    line-height: 1.8;
    font-size: 1em;
}

.section-content ul {
    list-style: none;
    padding-left: 0;
    margin-top: 15px;
}

.section-content li {
    padding: 8px 0 8px 25px;
    position: relative;
    color: #c0c0c0;
}

.section-content li::before {
    content: '‚öîÔ∏è';
    position: absolute;
    left: 0;
    font-size: 0.8em;
}

.prompt-box {
    background: rgba(0, 0, 0, 0.4);
    border-left: 4px solid #ffd700;
    padding: 15px 20px;
    margin: 15px 0;
    border-radius: 5px;
    color: #ffed4e;
    font-style: italic;
}

.generator-card {
    background: linear-gradient(145deg, rgba(30, 30, 60, 0.95), rgba(20, 20, 40, 0.95));
    border-radius: 20px;
    padding: 40px;
    box-shadow: 
        0 8px 32px 0 rgba(0, 0, 0, 0.7),
        inset 0 0 20px rgba(255, 215, 0, 0.1);
    border: 2px solid rgba(255, 215, 0, 0.3);
    backdrop-filter: blur(10px);
    text-align: center;
    margin-bottom: 40px;
}

.generator-title {
    color: #ffd700;
    font-size: 2em;
    margin-bottom: 20px;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
}

.generator-btn {
    padding: 16px 40px;
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    border: none;
    border-radius: 10px;
    color: #1a1a2e;
    font-size: 1.2em;
    font-weight: bold;
    font-family: 'Cinzel', 'Georgia', serif;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 2px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
    position: relative;
    overflow: hidden;
}

.generator-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

.generator-btn:hover::before {
    width: 300px;
    height: 300px;
}

.generator-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 25px rgba(255, 215, 0, 0.6);
}

.result-box {
    margin-top: 30px;
    padding: 25px;
    background: rgba(0, 0, 0, 0.4);
    border: 2px solid #ffd700;
    border-radius: 15px;
    min-height: 100px;
    display: none;
}

.result-box.active {
    display: block;
    animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.result-text {
    color: #ffd700;
    font-size: 1.3em;
    line-height: 1.8;
    text-align: left;
}

.result-label {
    color: #ffed4e;
    font-weight: bold;
    margin-top: 15px;
    display: block;
}

.mode-selector {
    display: flex;
    gap: 20px;
    justify-content: center;
    margin-bottom: 30px;
}

.mode-btn {
    padding: 12px 30px;
    background: rgba(0, 0, 0, 0.4);
    border: 2px solid rgba(255, 215, 0, 0.3);
    border-radius: 10px;
    color: #c0c0c0;
    font-size: 1em;
    font-family: 'Cinzel', 'Georgia', serif;
    cursor: pointer;
    transition: all 0.3s ease;
}

.mode-btn:hover {
    border-color: #ffd700;
    color: #ffd700;
    transform: translateY(-2px);
}

.mode-btn.active {
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    color: #1a1a2e;
    border-color: #ffd700;
    font-weight: bold;
}

.mode-indicator {
    text-align: center;
    color: #c0c0c0;
    font-size: 0.9em;
    margin-bottom: 20px;
    font-style: italic;
}

.cozy-only {
    display: none;
}

.action-only {
    display: block;
}

.example-card {
    background: rgba(0, 0, 0, 0.3);
    padding: 20px;
    border-radius: 10px;
    border: 1px solid rgba(255, 215, 0, 0.2);
    margin: 15px 0;
}

.example-title {
    color: #ffd700;
    font-weight: bold;
    margin-bottom: 10px;
}

.example-text {
    color: #c0c0c0;
    line-height: 1.6;
}

/* Responsive design */
  @media (max-width: 768px) {
    .content-grid {
        grid-template-columns: 1fr;
    }
    
    .main-title {
        font-size: 2em;
    }
    
    .section-title {
        font-size: 1.5em;
    }
  }

  /* RPG Navigation Sidebar Styles */
  .rpg-nav-sidebar {
    position: fixed;
    left: 0;
    top: 0;
    height: 100vh;
    width: 280px;
    background: linear-gradient(145deg, rgba(20, 20, 40, 0.98), rgba(10, 10, 20, 0.98));
    backdrop-filter: blur(10px);
    box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
    transform: translateX(-280px);
    transition: transform 0.3s ease;
    z-index: 1000;
    border-right: 2px solid rgba(255, 215, 0, 0.3);
  }

  .rpg-nav-sidebar.open {
    transform: translateX(0);
  }

  .nav-toggle {
    position: absolute;
    right: -50px;
    top: 20px;
    width: 50px;
    height: 50px;
    background: linear-gradient(145deg, rgba(20, 20, 40, 0.98), rgba(10, 10, 20, 0.98));
    border: 2px solid rgba(255, 215, 0, 0.3);
    border-left: none;
    border-radius: 0 10px 10px 0;
    color: #ffd700;
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .nav-toggle:hover {
    background: rgba(255, 215, 0, 0.1);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
  }

  .nav-content {
    padding: 30px 20px;
    height: 100%;
    overflow-y: auto;
  }

  .nav-title {
    color: #ffd700;
    font-size: 1.5em;
    font-family: 'Cinzel', 'Georgia', serif;
    text-align: center;
    margin-bottom: 10px;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  }

  .nav-divider {
    height: 2px;
    background: linear-gradient(90deg, transparent, #ffd700, transparent);
    margin-bottom: 20px;
  }

  .nav-links {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .nav-link {
    display: flex;
    align-items: center;
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border: 2px solid rgba(255, 215, 0, 0.2);
    border-radius: 10px;
    color: #c0c0c0;
    text-decoration: none;
    transition: all 0.3s ease;
    position: relative;
  }

  .nav-link:hover:not(.locked) {
    background: rgba(255, 215, 0, 0.1);
    border-color: #ffd700;
    transform: translateX(5px);
  }

  .nav-link.active {
    background: rgba(255, 215, 0, 0.15);
    border-color: #ffd700;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
  }

  .nav-link.visited .nav-check {
    display: inline;
  }

  .nav-link.locked {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }

  .nav-link.locked .nav-lock {
    display: inline;
  }

  .nav-link:not(.locked) .nav-lock {
    display: none;
  }

  .nav-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 30px;
    height: 30px;
    background: rgba(255, 215, 0, 0.2);
    border-radius: 50%;
    color: #ffd700;
    font-weight: bold;
    margin-right: 12px;
    flex-shrink: 0;
  }

  .nav-text {
    flex: 1;
    font-size: 0.95em;
  }

  .nav-check {
    color: #4cc9f0;
    font-size: 1.2em;
    display: none;
    margin-left: 8px;
  }

  .nav-lock {
    color: #ff6b6b;
    font-size: 1em;
    margin-left: 8px;
  }

  @media (max-width: 768px) {
    .rpg-nav-sidebar {
      width: 240px;
      transform: translateX(-240px);
    }
  }
</style><div class="container">
    <!-- World Map Quest Tracker -->
    <div class="generator-card">
        <h2 class="generator-title">üó∫Ô∏è World Map Quest Tracker</h2>
        <p style="color: #c0c0c0; margin-bottom: 25px;">Build your campaign by creating quests for different locations!</p>
        
        <form id="quest-form" style="max-width: 600px; margin: 0 auto; text-align: left;">
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Quest Title:</label>
                <input type="text" id="quest-title" required
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em;">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Location Type:</label>
                <select id="quest-location" required
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em;">
                    <option value="">Select a location...</option>
                    <option value="town">üèòÔ∏è Town</option>
                    <option value="dungeon">‚õèÔ∏è Dungeon</option>
                    <option value="forest">üå≤ Forest</option>
                    <option value="mountain">‚õ∞Ô∏è Mountain</option>
                    <option value="castle">üè∞ Castle</option>
                    <option value="cave">üï≥Ô∏è Cave</option>
                    <option value="ocean">üåä Ocean</option>
                    <option value="desert">üèúÔ∏è Desert</option>
                </select>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Quest Objective:</label>
                <textarea id="quest-objective" required rows="3"
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em; resize: vertical;"></textarea>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Difficulty Level:</label>
                <select id="quest-difficulty" required
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em;">
                    <option value="">Select difficulty...</option>
                    <option value="easy">‚≠ê Easy</option>
                    <option value="medium">‚≠ê‚≠ê Medium</option>
                    <option value="hard">‚≠ê‚≠ê‚≠ê Hard</option>
                    <option value="epic">‚≠ê‚≠ê‚≠ê‚≠ê Epic</option>
                </select>
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Reward:</label>
                <input type="text" id="quest-reward" required
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em;">
            </div>
            
            <button type="submit" class="generator-btn">
                <span style="position: relative; z-index: 1;">Add Quest to Log</span>
            </button>
        </form>
        
        <div id="quest-log-result" class="result-box" style="margin-top: 30px;">
            <h3 style="color: #ffd700; margin-bottom: 20px; text-align: center;">üìú Your Quest Log</h3>
            <div id="quest-log-content" class="result-text"></div>
            <button onclick="downloadQuestLog()" class="generator-btn" style="margin-top: 20px; padding: 12px 30px; font-size: 1em;">
                <span style="position: relative; z-index: 1;">üì• Download Quest Log</span>
            </button>
        </div>
    </div>

    <!-- Character Builder Form -->
    <div class="generator-card">
        <h2 class="generator-title">üé® Character Builder</h2>
        <p style="color: #c0c0c0; margin-bottom: 25px;">Create a detailed character sheet by filling out the form below!</p>
        
        <form id="character-form" style="max-width: 600px; margin: 0 auto; text-align: left;">
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Character Name:</label>
                <input type="text" id="char-name" name="name" required
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em;">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Motivation (What drives them?):</label>
                <textarea id="char-motivation" name="motivation" required rows="3"
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em; resize: vertical;"></textarea>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Greatest Fear:</label>
                <textarea id="char-fear" name="fear" required rows="3"
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em; resize: vertical;"></textarea>
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Hidden Secret:</label>
                <textarea id="char-secret" name="secret" required rows="3"
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em; resize: vertical;"></textarea>
            </div>
            
            <button type="submit" class="generator-btn">
                <span style="position: relative; z-index: 1;">Create Character Sheet</span>
            </button>
        </form>
        
        <div id="character-sheet-result" class="result-box" style="margin-top: 30px;">
            <div id="character-sheet-content" class="result-text"></div>
            <button onclick="downloadCharacterSheet()" class="generator-btn" style="margin-top: 20px; padding: 12px 30px; font-size: 1em;">
                <span style="position: relative; z-index: 1;">üì• Download Character Sheet</span>
            </button>
        </div>
    </div>

    <!-- Jokes Activity -->
    <div class="generator-card">
        <h2 class="generator-title">üòÇ Flask Backend Jokes</h2>
        <p style="color: #c0c0c0; margin-bottom: 25px;">Enjoy some jokes and react with HaHa or Boohoo!</p>
        
        <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
            <thead>
                <tr style="background: rgba(255, 215, 0, 0.2); border: 2px solid rgba(255, 215, 0, 0.3);">
                    <th style="padding: 15px; color: #ffd700; text-align: left; border: 1px solid rgba(255, 215, 0, 0.3);">Joke</th>
                    <th style="padding: 15px; color: #ffd700; text-align: center; border: 1px solid rgba(255, 215, 0, 0.3);">HaHa</th>
                    <th style="padding: 15px; color: #ffd700; text-align: center; border: 1px solid rgba(255, 215, 0, 0.3);">Boohoo</th>
                </tr>
            </thead>
            <tbody id="result">
                <!-- javascript generated data -->
            </tbody>
        </table>
    </div>
</div>

<script>
// Check for game mode from page 2 (stored in localStorage)
let gameMode = localStorage.getItem('rpgGameMode') || 'action'; // default to action

// Character Builder Form Handler
let characterSheetData = null;
let questLogData = [];

document.addEventListener('DOMContentLoaded', () => {
    const characterForm = document.getElementById('character-form');
    if (characterForm) {
        characterForm.addEventListener('submit', handleCharacterSubmit);
    }
    
    const questForm = document.getElementById('quest-form');
    if (questForm) {
        questForm.addEventListener('submit', handleQuestSubmit);
    }
    
    // Load existing quest log
    loadQuestLog();
});

async function handleCharacterSubmit(event) {
    event.preventDefault();
    
    // Get user session data
    const userSession = localStorage.getItem('userSession');
    if (!userSession) {
        alert('Please login first to create characters!');
        window.location.href = '/rpg/login';
        return;
    }
    
    const sessionData = JSON.parse(userSession);
    
    const formData = {
        name: document.getElementById('char-name').value,
        motivation: document.getElementById('char-motivation').value,
        fear: document.getElementById('char-fear').value,
        secret: document.getElementById('char-secret').value,
        gameMode: gameMode,
        userGithubId: sessionData.githubId  // Add user ID
    };
    
    try {
        const response = await fetch('http://localhost:8587/api/rpg/character', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        if (response.ok) {
            const result = await response.json();
            characterSheetData = result;
            displayCharacterSheet(result);
        } else {
            alert('Error creating character sheet. Please try again.');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Could not connect to server. Please make sure the Flask backend is running.');
    }
}

function displayCharacterSheet(data) {
    const resultBox = document.getElementById('character-sheet-result');
    const content = document.getElementById('character-sheet-content');
    
    content.innerHTML = `
        <div style="border: 3px solid #ffd700; border-radius: 15px; padding: 30px; background: rgba(0, 0, 0, 0.6);">
            <h2 style="color: #ffd700; text-align: center; font-size: 2.5em; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 3px;">
                ${data.name}
            </h2>
            <p style="text-align: center; color: #ffed4e; font-style: italic; margin-bottom: 30px; font-size: 1.1em;">
                ${data.gameMode === 'cozy' ? 'üåø Cozy RPG Character' : '‚öîÔ∏è Action RPG Character'}
            </p>
            
            <div style="margin-bottom: 25px; padding: 20px; background: rgba(255, 215, 0, 0.1); border-radius: 10px; border-left: 4px solid #ffd700;">
                <h3 style="color: #ffed4e; margin-bottom: 10px; font-size: 1.3em;">üí´ Motivation</h3>
                <p style="color: #e0e0e0; line-height: 1.8; font-size: 1.1em;">${data.motivation}</p>
            </div>
            
            <div style="margin-bottom: 25px; padding: 20px; background: rgba(255, 215, 0, 0.1); border-radius: 10px; border-left: 4px solid #ffd700;">
                <h3 style="color: #ffed4e; margin-bottom: 10px; font-size: 1.3em;">üò∞ Greatest Fear</h3>
                <p style="color: #e0e0e0; line-height: 1.8; font-size: 1.1em;">${data.fear}</p>
            </div>
            
            <div style="margin-bottom: 25px; padding: 20px; background: rgba(255, 215, 0, 0.1); border-radius: 10px; border-left: 4px solid #ffd700;">
                <h3 style="color: #ffed4e; margin-bottom: 10px; font-size: 1.3em;">ü§´ Hidden Secret</h3>
                <p style="color: #e0e0e0; line-height: 1.8; font-size: 1.1em;">${data.secret}</p>
            </div>
            
            <div style="padding: 20px; background: rgba(255, 215, 0, 0.05); border-radius: 10px; border: 2px dashed #ffd700;">
                <h3 style="color: #ffed4e; margin-bottom: 15px; font-size: 1.3em;">üìù Character Analysis</h3>
                <p style="color: #c0c0c0; line-height: 1.8; font-size: 1em;">${data.analysis}</p>
            </div>
            
            <p style="text-align: center; color: #888; margin-top: 25px; font-size: 0.9em;">
                Created on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
            </p>
        </div>
    `;
    
    resultBox.classList.add('active');
}

function downloadCharacterSheet() {
    if (!characterSheetData) {
        alert('No character sheet to download!');
        return;
    }
    
    const textContent = `
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    CHARACTER SHEET
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

NAME: ${characterSheetData.name}
TYPE: ${characterSheetData.gameMode === 'cozy' ? 'Cozy RPG Character' : 'Action RPG Character'}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
MOTIVATION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
${characterSheetData.motivation}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
GREATEST FEAR
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
${characterSheetData.fear}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
HIDDEN SECRET
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
${characterSheetData.secret}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
CHARACTER ANALYSIS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
${characterSheetData.analysis}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Created on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    `;
    
    const blob = new Blob([textContent], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${characterSheetData.name.replace(/\s+/g, '_')}_CharacterSheet.txt`;
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
}

// Quest Tracker Handler
async function handleQuestSubmit(event) {
    event.preventDefault();
    
    // Get user session data
    const userSession = localStorage.getItem('userSession');
    if (!userSession) {
        alert('Please login first to create quests!');
        window.location.href = '/rpg/login';
        return;
    }
    
    const sessionData = JSON.parse(userSession);
    
    const questData = {
        title: document.getElementById('quest-title').value,
        location: document.getElementById('quest-location').value,
        objective: document.getElementById('quest-objective').value,
        difficulty: document.getElementById('quest-difficulty').value,
        reward: document.getElementById('quest-reward').value,
        gameMode: gameMode,
        userGithubId: sessionData.githubId  // Add user ID
    };
    
    try {
        const response = await fetch('http://localhost:8587/api/rpg/quest', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(questData)
        });
        
        if (response.ok) {
            const result = await response.json();
            questLogData.push(result);
            displayQuestLog();
            event.target.reset();
            alert('‚úÖ Quest added to your log!');
        } else {
            alert('Error adding quest. Please try again.');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Could not connect to server. Please make sure the Flask backend is running.');
    }
}

async function loadQuestLog() {
    // Get user session data
    const userSession = localStorage.getItem('userSession');
    if (!userSession) {
        return; // Don't load quests if not logged in
    }
    
    const sessionData = JSON.parse(userSession);
    
    try {
        const response = await fetch(`http://localhost:8587/api/rpg/quests?userGithubId=${encodeURIComponent(sessionData.githubId)}`);
        if (response.ok) {
            const result = await response.json();
            questLogData = result.quests || [];
            if (questLogData.length > 0) {
                displayQuestLog();
            }
        }
    } catch (error) {
        console.error('Error loading quest log:', error);
    }
}

function displayQuestLog() {
    const resultBox = document.getElementById('quest-log-result');
    const content = document.getElementById('quest-log-content');
    
    if (questLogData.length === 0) {
        content.innerHTML = '<p style="color: #c0c0c0; text-align: center; font-style: italic;">No quests yet. Add your first quest above!</p>';
        resultBox.classList.add('active');
        return;
    }
    
    const locationIcons = {
        'town': 'üèòÔ∏è',
        'dungeon': '‚õèÔ∏è',
        'forest': 'üå≤',
        'mountain': '‚õ∞Ô∏è',
        'castle': 'üè∞',
        'cave': 'üï≥Ô∏è',
        'ocean': 'üåä',
        'desert': 'üèúÔ∏è'
    };
    
    const difficultyStars = {
        'easy': '‚≠ê',
        'medium': '‚≠ê‚≠ê',
        'hard': '‚≠ê‚≠ê‚≠ê',
        'epic': '‚≠ê‚≠ê‚≠ê‚≠ê'
    };
    
    let questsHTML = '';
    questLogData.forEach((quest, index) => {
        questsHTML += `
            <div style="margin-bottom: 20px; padding: 20px; background: rgba(255, 215, 0, 0.1); border-radius: 10px; border-left: 4px solid #ffd700;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h3 style="color: #ffd700; margin: 0; font-size: 1.3em;">${locationIcons[quest.location] || 'üìç'} ${quest.title}</h3>
                    <span style="color: #ffed4e; font-size: 0.9em;">#${index + 1}</span>
                </div>
                <p style="color: #ffed4e; margin: 5px 0;"><strong>Location:</strong> ${quest.location.charAt(0).toUpperCase() + quest.location.slice(1)}</p>
                <p style="color: #e0e0e0; margin: 10px 0; line-height: 1.6;"><strong style="color: #ffed4e;">Objective:</strong> ${quest.objective}</p>
                <div style="display: flex; justify-content: space-between; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 215, 0, 0.2);">
                    <span style="color: #c0c0c0;"><strong style="color: #ffed4e;">Difficulty:</strong> ${difficultyStars[quest.difficulty]} ${quest.difficulty.charAt(0).toUpperCase() + quest.difficulty.slice(1)}</span>
                    <span style="color: #c0c0c0;"><strong style="color: #ffed4e;">Reward:</strong> ${quest.reward}</span>
                </div>
            </div>
        `;
    });
    
    content.innerHTML = questsHTML;
    resultBox.classList.add('active');
}

function downloadQuestLog() {
    if (questLogData.length === 0) {
        alert('No quests to download!');
        return;
    }
    
    let textContent = `
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    QUEST LOG - ${gameMode === 'cozy' ? 'COZY RPG' : 'ACTION RPG'}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Total Quests: ${questLogData.length}

`;
    
    questLogData.forEach((quest, index) => {
        textContent += `
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
QUEST #${index + 1}: ${quest.title}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Location: ${quest.location.charAt(0).toUpperCase() + quest.location.slice(1)}
Difficulty: ${quest.difficulty.charAt(0).toUpperCase() + quest.difficulty.slice(1)}

Objective:
${quest.objective}

Reward: ${quest.reward}

`;
    });
    
    textContent += `
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Created on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    `;
    
    const blob = new Blob([textContent], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `QuestLog_${new Date().toISOString().split('T')[0]}.txt`;
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
}

// Navigation Sidebar Functionality
const sidebar = document.getElementById('rpg-nav-sidebar');
const navToggle = document.getElementById('nav-toggle');
const currentPage = 3; // This is page 3

// Toggle sidebar
navToggle.addEventListener('click', () => {
  sidebar.classList.toggle('open');
});

// Track page visit
function trackPageVisit(pageNumber) {
  let visitedPages = JSON.parse(localStorage.getItem('rpgVisitedPages') || '[]');
  if (!visitedPages.includes(pageNumber)) {
    visitedPages.push(pageNumber);
    localStorage.setItem('rpgVisitedPages', JSON.stringify(visitedPages));
  }
}

// Check if review page should be unlocked
function updateReviewLock() {
  const visitedPages = JSON.parse(localStorage.getItem('rpgVisitedPages') || '[]');
  const requiredPages = [2, 3, 4, 5];
  const allVisited = requiredPages.every(page => visitedPages.includes(page));
  
  const reviewLink = document.getElementById('review-link');
  if (reviewLink) {
    if (allVisited) {
      reviewLink.classList.remove('locked');
    } else {
      reviewLink.classList.add('locked');
    }
  }
}

// Update visited page indicators
function updateVisitedIndicators() {
  const visitedPages = JSON.parse(localStorage.getItem('rpgVisitedPages') || '[]');
  document.querySelectorAll('.nav-link').forEach(link => {
    const pageNum = parseInt(link.dataset.page);
    if (visitedPages.includes(pageNum)) {
      link.classList.add('visited');
    }
  });
}

// Track current page visit
trackPageVisit(currentPage);
updateVisitedIndicators();
updateReviewLock();
</script>

<script type="module">
  import { javaURI, pythonURI, fetchOptions } from '{{ site.baseurl }}/assets/js/api/config.js';

  // prepare HTML defined "result" container for new output
  const resultContainer = document.getElementById("result");

  // keys for joke reactions
  const HAHA = "haha";
  const BOOHOO = "boohoo";

  // prepare fetch urls
  const url = `${pythonURI}/api/jokes`;
  //const url = `${javaURI}/api/jokes`;
  const getURL = url +"/";
  const likeURL = url + "/like/";  // haha reaction
  const jeerURL = url + "/jeer/";  // boohoo reaction

  // prepare fetch PUT options, clones with JS Spread Operator (...)
  const reactOptions = {...fetchOptions,
    method: 'PUT',
  }; // clones and replaces method


  // fetch the API to obtain jokes data
  fetch(getURL, fetchOptions)
    .then(response => {
      if (response.status !== 200) {
        error('GET API response failure: ' + response.status);
        return;
      }
      response.json().then(data => {
        console.log(data);
        // format response data into a table
        for (const row of data) {
          // make "tr element" for each "row of data"
          const tr = document.createElement("tr");
          tr.style.borderBottom = "1px solid rgba(255, 215, 0, 0.2)";

          // td for joke cell
          const joke = document.createElement("td");
          joke.style.padding = "15px";
          joke.style.color = "#e0e0e0";
          joke.style.border = "1px solid rgba(255, 215, 0, 0.2)";
          joke.innerHTML = row.id + ". " + row.joke;

          // td for haha cell with onclick actions
          const haha = document.createElement("td");
          haha.style.padding = "15px";
          haha.style.textAlign = "center";
          haha.style.border = "1px solid rgba(255, 215, 0, 0.2)";
          const hahaBtn = document.createElement('button');
          hahaBtn.id = HAHA + row.id;
          hahaBtn.innerHTML = row.haha;
          hahaBtn.style.padding = "8px 16px";
          hahaBtn.style.background = "rgba(76, 201, 240, 0.2)";
          hahaBtn.style.border = "2px solid rgba(76, 201, 240, 0.5)";
          hahaBtn.style.borderRadius = "8px";
          hahaBtn.style.color = "#4cc9f0";
          hahaBtn.style.cursor = "pointer";
          hahaBtn.style.fontFamily = "'Cinzel', 'Georgia', serif";
          hahaBtn.style.transition = "all 0.3s ease";
          hahaBtn.onmouseover = function() {
            this.style.background = "rgba(76, 201, 240, 0.4)";
            this.style.transform = "scale(1.05)";
          };
          hahaBtn.onmouseout = function() {
            this.style.background = "rgba(76, 201, 240, 0.2)";
            this.style.transform = "scale(1)";
          };
          hahaBtn.onclick = function () {
            reaction(HAHA, likeURL + row.id, hahaBtn.id);
          };
          haha.appendChild(hahaBtn);

          // td for boohoo cell with onclick actions
          const boohoo = document.createElement("td");
          boohoo.style.padding = "15px";
          boohoo.style.textAlign = "center";
          boohoo.style.border = "1px solid rgba(255, 215, 0, 0.2)";
          const boohooBtn = document.createElement('button');
          boohooBtn.id = BOOHOO + row.id;
          boohooBtn.innerHTML = row.boohoo;
          boohooBtn.style.padding = "8px 16px";
          boohooBtn.style.background = "rgba(255, 107, 107, 0.2)";
          boohooBtn.style.border = "2px solid rgba(255, 107, 107, 0.5)";
          boohooBtn.style.borderRadius = "8px";
          boohooBtn.style.color = "#ff6b6b";
          boohooBtn.style.cursor = "pointer";
          boohooBtn.style.fontFamily = "'Cinzel', 'Georgia', serif";
          boohooBtn.style.transition = "all 0.3s ease";
          boohooBtn.onmouseover = function() {
            this.style.background = "rgba(255, 107, 107, 0.4)";
            this.style.transform = "scale(1.05)";
          };
          boohooBtn.onmouseout = function() {
            this.style.background = "rgba(255, 107, 107, 0.2)";
            this.style.transform = "scale(1)";
          };
          boohooBtn.onclick = function () {
            reaction(BOOHOO, jeerURL + row.id, boohooBtn.id);
          };
          boohoo.appendChild(boohooBtn);

          // finish row and append to DOM container
          tr.appendChild(joke);
          tr.appendChild(haha);
          tr.appendChild(boohoo);
          resultContainer.appendChild(tr);
        }
      })
    })
    .catch(err => {
      error(err + ": " + getURL);
    });

  // Function and interval to refresh the haha and boohoo counts every 5 seconds
  function refreshReactions() {
    fetch(getURL, fetchOptions)
      .then(response => response.json())
      .then(data => {
        // update all reaction data
        for (const row of data) {
          const hahaBtn = document.getElementById(HAHA + row.id);
          if (hahaBtn) hahaBtn.innerHTML = row.haha;
          const boohooBtn = document.getElementById(BOOHOO + row.id);
          if (boohooBtn) boohooBtn.innerHTML = row.boohoo;
        }
      })
      .catch(err => {
        // Optionally handle refresh errors
        console.error('Refresh error:', err);
      });
  }
  // Call refreshReactions every 5 seconds
  setInterval(refreshReactions, 5000);

  // Reaction function to likes or jeers user actions
  function reaction(type, postURL, elemID) {

    // fetch the API
    fetch(postURL, reactOptions)
    // response is a RESTful "promise" on any successful fetch
    .then(response => {
      // check for response errors
      if (response.status !== 200) {
          error("Post API response failure: " + response.status)
          return;  // api failure
      }
      // valid response will have JSON data
      response.json().then(data => {
          console.log(data);
          // Likes or Jeers updated/incremented
          if (type === HAHA) // like data element
            document.getElementById(elemID).innerHTML = data.haha;  // fetched haha data assigned to haha Document Object Model (DOM)
          else if (type === BOOHOO) // jeer data element
            document.getElementById(elemID).innerHTML = data.boohoo;  // fetched boohoo data assigned to boohoo Document Object Model (DOM)
          else
            error("unknown type: " + type);  // should never occur
      })
    })
    // catch fetch errors (ie Nginx ACCESS to server blocked)
    .catch(err => {
      error(err + " " + postURL);
    });
  
  }

  // Something went wrong with actions or responses
  function error(err) {
    // log as Error in console
    console.error(err);
    // append error to resultContainer
    const tr = document.createElement("tr");
    const td = document.createElement("td");
    td.style.padding = "15px";
    td.style.color = "#ff6b6b";
    td.innerHTML = err;
    tr.appendChild(td);
    resultContainer.appendChild(tr);
  }

</script>