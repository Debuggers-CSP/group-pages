---
layout: post
title: Story, Plot & Purpose Tutorial
description: Teach the fundamentals of creating a compelling RPG narrative.
permalink: /rpg/story
comments: True
---

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Cinzel', 'Georgia', serif;
    background: #1a1a2e;
    min-height: 100vh;
    height: auto;
    position: relative;
    overflow-x: hidden;
    overflow-y: auto;
    padding: 40px 20px;
}

/* Animated background particles */
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
        radial-gradient(2px 2px at 20% 30%, white, transparent),
        radial-gradient(2px 2px at 60% 70%, white, transparent),
        radial-gradient(1px 1px at 50% 50%, white, transparent),
        radial-gradient(1px 1px at 80% 10%, white, transparent),
        radial-gradient(2px 2px at 90% 60%, white, transparent);
    background-size: 200% 200%;
    animation: stars 20s linear infinite;
    opacity: 0.3;
    z-index: 0;
}

@keyframes stars {
    from { transform: translate(0, 0); }
    to { transform: translate(-50%, -50%); }
}

.container {
    position: relative;
    z-index: 10;
    max-width: 1200px;
    margin: 0 auto;
}

.header-card {
    background: linear-gradient(145deg, rgba(30, 30, 60, 0.95), rgba(20, 20, 40, 0.95));
    border-radius: 20px;
    padding: 40px;
    box-shadow: 
        0 8px 32px 0 rgba(0, 0, 0, 0.7),
        inset 0 0 20px rgba(255, 215, 0, 0.1),
        0 0 40px rgba(255, 215, 0, 0.2);
    border: 2px solid rgba(255, 215, 0, 0.3);
    backdrop-filter: blur(10px);
    text-align: center;
    margin-bottom: 40px;
}

.title-icon {
    font-size: 4em;
    margin-bottom: 20px;
    filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
}

.main-title {
    color: #ffd700;
    font-size: 3em;
    margin-bottom: 15px;
    text-shadow: 
        0 0 10px rgba(255, 215, 0, 0.5),
        0 0 20px rgba(255, 215, 0, 0.3),
        2px 2px 4px rgba(0, 0, 0, 0.8);
    letter-spacing: 3px;
}

.subtitle {
    color: #c0c0c0;
    font-size: 1.2em;
    font-style: italic;
    opacity: 0.9;
}

.content-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 30px;
    margin-bottom: 40px;
}

.section-card {
    background: linear-gradient(145deg, rgba(30, 30, 60, 0.95), rgba(20, 20, 40, 0.95));
    border-radius: 20px;
    padding: 30px;
    box-shadow: 
        0 8px 32px 0 rgba(0, 0, 0, 0.7),
        inset 0 0 20px rgba(255, 215, 0, 0.1);
    border: 2px solid rgba(255, 215, 0, 0.3);
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
}

.section-card:hover {
    transform: translateY(-5px);
    box-shadow: 
        0 12px 40px 0 rgba(0, 0, 0, 0.8),
        inset 0 0 30px rgba(255, 215, 0, 0.2),
        0 0 60px rgba(255, 215, 0, 0.3);
}

.section-icon {
    font-size: 2.5em;
    margin-bottom: 15px;
    display: block;
}

.section-title {
    color: #ffd700;
    font-size: 1.8em;
    margin-bottom: 15px;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
}

.section-content {
    color: #e0e0e0;
    line-height: 1.8;
    font-size: 1em;
}

.section-content ul {
    list-style: none;
    padding-left: 0;
    margin-top: 15px;
}

.section-content li {
    padding: 8px 0 8px 25px;
    position: relative;
    color: #c0c0c0;
}

.section-content li::before {
    content: 'âš”ï¸';
    position: absolute;
    left: 0;
    font-size: 0.8em;
}

.prompt-box {
    background: rgba(0, 0, 0, 0.4);
    border-left: 4px solid #ffd700;
    padding: 15px 20px;
    margin: 15px 0;
    border-radius: 5px;
    color: #ffed4e;
    font-style: italic;
}

.generator-card {
    background: linear-gradient(145deg, rgba(30, 30, 60, 0.95), rgba(20, 20, 40, 0.95));
    border-radius: 20px;
    padding: 40px;
    box-shadow: 
        0 8px 32px 0 rgba(0, 0, 0, 0.7),
        inset 0 0 20px rgba(255, 215, 0, 0.1);
    border: 2px solid rgba(255, 215, 0, 0.3);
    backdrop-filter: blur(10px);
    text-align: center;
    margin-bottom: 40px;
}

.generator-title {
    color: #ffd700;
    font-size: 2em;
    margin-bottom: 20px;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
}

.generator-btn {
    padding: 16px 40px;
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    border: none;
    border-radius: 10px;
    color: #1a1a2e;
    font-size: 1.2em;
    font-weight: bold;
    font-family: 'Cinzel', 'Georgia', serif;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 2px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
    position: relative;
    overflow: hidden;
}

.generator-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

.generator-btn:hover::before {
    width: 300px;
    height: 300px;
}

.generator-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 25px rgba(255, 215, 0, 0.6);
}

.result-box {
    margin-top: 30px;
    padding: 25px;
    background: rgba(0, 0, 0, 0.4);
    border: 2px solid #ffd700;
    border-radius: 15px;
    min-height: 100px;
    display: none;
}

.result-box.active {
    display: block;
    animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.result-text {
    color: #ffd700;
    font-size: 1.3em;
    line-height: 1.8;
    text-align: left;
}

.result-label {
    color: #ffed4e;
    font-weight: bold;
    margin-top: 15px;
    display: block;
}

.mode-selector {
    display: flex;
    gap: 20px;
    justify-content: center;
    margin-bottom: 30px;
}

.mode-btn {
    padding: 12px 30px;
    background: rgba(0, 0, 0, 0.4);
    border: 2px solid rgba(255, 215, 0, 0.3);
    border-radius: 10px;
    color: #c0c0c0;
    font-size: 1em;
    font-family: 'Cinzel', 'Georgia', serif;
    cursor: pointer;
    transition: all 0.3s ease;
}

.mode-btn:hover {
    border-color: #ffd700;
    color: #ffd700;
    transform: translateY(-2px);
}

.mode-btn.active {
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    color: #1a1a2e;
    border-color: #ffd700;
    font-weight: bold;
}

.mode-indicator {
    text-align: center;
    color: #c0c0c0;
    font-size: 0.9em;
    margin-bottom: 20px;
    font-style: italic;
}

.cozy-only {
    display: none;
}

.action-only {
    display: block;
}

.example-card {
    background: rgba(0, 0, 0, 0.3);
    padding: 20px;
    border-radius: 10px;
    border: 1px solid rgba(255, 215, 0, 0.2);
    margin: 15px 0;
}

.example-title {
    color: #ffd700;
    font-weight: bold;
    margin-bottom: 10px;
}

.example-text {
    color: #c0c0c0;
    line-height: 1.6;
}

/* Responsive design */
@media (max-width: 768px) {
    .content-grid {
        grid-template-columns: 1fr;
    }
    
    .main-title {
        font-size: 2em;
    }
    
    .section-title {
        font-size: 1.5em;
    }
}
</style>

<div class="container">
    <!-- Header -->
    <div class="header-card">
        <div class="title-icon">ğŸ“–</div>
        <h1 class="main-title">STORY & NARRATIVE</h1>
        <p class="subtitle">Craft Compelling RPG Adventures</p>
        <p class="mode-indicator" id="current-mode-display"></p>
    </div>

    <!-- Main Content Sections -->
    <div class="content-grid">
        <!-- Storyline -->
        <div class="section-card">
            <span class="section-icon">âœ¨</span>
            <h2 class="section-title">Main Storyline</h2>
            <div class="section-content">
                <p>Every great RPG begins with a compelling story. Your main storyline is the backbone of your adventure.</p>
                
                <div class="prompt-box">
                    ğŸ’­ What event sets your main character's journey in motion?
                </div>
                
                <ul>
                    <li>Opening Hook - An event that disrupts the character's normal life</li>
                    <li>Rising Action - Challenges that build toward the climax</li>
                    <li>Climax - The final confrontation or decision</li>
                    <li>Resolution - How the world changes after the character's actions</li>
                </ul>
                
                <div class="example-card">
                    <div class="example-title">Example:</div>
                    <div class="example-text">
                        "A mysterious plague is turning villagers to stone. The main character discovers they're the last descendant of an ancient order that once defeated this evil."
                    </div>
                </div>
            </div>
        </div>

        <!-- World Design -->
        <div class="section-card">
            <span class="section-icon">ğŸ—ºï¸</span>
            <h2 class="section-title">World Design</h2>
            <div class="section-content">
                <p>Build a living, breathing world that feels real and immersive.</p>
                
                <div class="prompt-box">
                    ğŸ’­ What makes your world unique and memorable?
                </div>
                
                <ul>
                    <li>Towns - Safe havens with NPCs, shops, and quests</li>
                    <li>Forests - Mysterious areas with hidden secrets</li>
                    <li>Dungeons - Dangerous locations with valuable rewards</li>
                    <li>Factions - Groups with their own goals and conflicts</li>
                    <li>Lore - History that explains why things are the way they are</li>
                </ul>
                
                <div class="example-card">
                    <div class="example-title">Example Locations:</div>
                    <div class="example-text">
                        <strong>Silverwood Village:</strong> A peaceful town under threat<br>
                        <strong>The Whispering Forest:</strong> Ancient trees hide forgotten magic<br>
                        <strong>Shadowkeep Dungeon:</strong> The source of the plague
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- World Map Quest Tracker -->
    <div class="generator-card">
        <h2 class="generator-title">ğŸ—ºï¸ World Map Quest Tracker</h2>
        <p style="color: #c0c0c0; margin-bottom: 25px;">Build your campaign by creating quests for different locations!</p>
        
        <form id="quest-form" style="max-width: 600px; margin: 0 auto; text-align: left;">
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Quest Title:</label>
                <input type="text" id="quest-title" required
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em;">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Location Type:</label>
                <select id="quest-location" required
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em;">
                    <option value="">Select a location...</option>
                    <option value="town">ğŸ˜ï¸ Town</option>
                    <option value="dungeon">â›ï¸ Dungeon</option>
                    <option value="forest">ğŸŒ² Forest</option>
                    <option value="mountain">â›°ï¸ Mountain</option>
                    <option value="castle">ğŸ° Castle</option>
                    <option value="cave">ğŸ•³ï¸ Cave</option>
                    <option value="ocean">ğŸŒŠ Ocean</option>
                    <option value="desert">ğŸœï¸ Desert</option>
                </select>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Quest Objective:</label>
                <textarea id="quest-objective" required rows="3"
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em; resize: vertical;"></textarea>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Difficulty Level:</label>
                <select id="quest-difficulty" required
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em;">
                    <option value="">Select difficulty...</option>
                    <option value="easy">â­ Easy</option>
                    <option value="medium">â­â­ Medium</option>
                    <option value="hard">â­â­â­ Hard</option>
                    <option value="epic">â­â­â­â­ Epic</option>
                </select>
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Reward:</label>
                <input type="text" id="quest-reward" required
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em;">
            </div>
            
            <button type="submit" class="generator-btn">
                <span style="position: relative; z-index: 1;">Add Quest to Log</span>
            </button>
        </form>
        
        <div id="quest-log-result" class="result-box" style="margin-top: 30px;">
            <h3 style="color: #ffd700; margin-bottom: 20px; text-align: center;">ğŸ“œ Your Quest Log</h3>
            <div id="quest-log-content" class="result-text"></div>
            <button onclick="downloadQuestLog()" class="generator-btn" style="margin-top: 20px; padding: 12px 30px; font-size: 1em;">
                <span style="position: relative; z-index: 1;">ğŸ“¥ Download Quest Log</span>
            </button>
        </div>
    </div>

    <div class="content-grid">
        <!-- Hero's Purpose -->
        <div class="section-card">
            <span class="section-icon">âš”ï¸</span>
            <h2 class="section-title">Character's Purpose</h2>
            <div class="section-content">
                <p>Define what drives your main character forward and gives meaning to their quest.</p>
                
                <div class="prompt-box">
                    ğŸ’­ Why does your main character choose to face danger?
                </div>
                
                <ul>
                    <li>Personal Stakes - What does the character stand to lose?</li>
                    <li>Greater Good - How does their quest help others?</li>
                    <li>Overarching Goal - The ultimate objective</li>
                    <li>Character Growth - How will they change?</li>
                </ul>
                
                <div class="example-card">
                    <div class="example-title">Purpose Examples:</div>
                    <div class="example-text">
                        â€¢ Save a loved one from the plague<br>
                        â€¢ Prove themselves worthy of their legacy<br>
                        â€¢ Prevent the destruction of their homeland<br>
                        â€¢ Discover the truth about their past
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Character Builder Form -->
    <div class="generator-card">
        <h2 class="generator-title">ğŸ¨ Character Builder</h2>
        <p style="color: #c0c0c0; margin-bottom: 25px;">Create a detailed character sheet by filling out the form below!</p>
        
        <form id="character-form" style="max-width: 600px; margin: 0 auto; text-align: left;">
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Character Name:</label>
                <input type="text" id="char-name" name="name" required
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em;">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Motivation (What drives them?):</label>
                <textarea id="char-motivation" name="motivation" required rows="3"
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em; resize: vertical;"></textarea>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Greatest Fear:</label>
                <textarea id="char-fear" name="fear" required rows="3"
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em; resize: vertical;"></textarea>
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Hidden Secret:</label>
                <textarea id="char-secret" name="secret" required rows="3"
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em; resize: vertical;"></textarea>
            </div>
            
            <button type="submit" class="generator-btn">
                <span style="position: relative; z-index: 1;">Create Character Sheet</span>
            </button>
        </form>
        
        <div id="character-sheet-result" class="result-box" style="margin-top: 30px;">
            <div id="character-sheet-content" class="result-text"></div>
            <button onclick="downloadCharacterSheet()" class="generator-btn" style="margin-top: 20px; padding: 12px 30px; font-size: 1em;">
                <span style="position: relative; z-index: 1;">ğŸ“¥ Download Character Sheet</span>
            </button>
        </div>
    </div>

    <div class="content-grid">
        <!-- Conflict -->
        <div class="section-card">
            <span class="section-icon">âš¡</span>
            <h2 class="section-title">Meaningful Conflict</h2>
            <div class="section-content">
                <p>Conflict creates tension and keeps players engaged. Layer different types for depth.</p>
                
                <div class="prompt-box">
                    ğŸ’­ What obstacles stand between the main character and their goal?
                </div>
                
                <ul>
                    <li class="action-only">External - Villains, monsters, environmental challenges</li>
                    <li class="cozy-only">External - Natural obstacles, weather, resource scarcity</li>
                    <li>Internal - Doubts, fears, moral dilemmas</li>
                    <li class="action-only">Interpersonal - Conflicts with allies or rivals</li>
                    <li class="cozy-only">Interpersonal - Misunderstandings, communication barriers</li>
                    <li class="action-only">Societal - Rules, prejudices, political intrigue</li>
                    <li class="cozy-only">Societal - Traditions to preserve, community needs</li>
                </ul>
                
                <div class="example-card action-only">
                    <div class="example-title">Conflict Layers:</div>
                    <div class="example-text">
                        <strong>Main:</strong> Defeat the Plague Lord<br>
                        <strong>Secondary:</strong> Convince doubting villagers to trust you<br>
                        <strong>Internal:</strong> Overcome fear of inadequacy
                    </div>
                </div>
                
                <div class="example-card cozy-only">
                    <div class="example-title">Conflict Layers:</div>
                    <div class="example-text">
                        <strong>Main:</strong> Restore the village's annual harvest festival<br>
                        <strong>Secondary:</strong> Learn forgotten traditions from elders<br>
                        <strong>Internal:</strong> Balance personal goals with community needs
                    </div>
                </div>
            </div>
        </div>

        <!-- Characters -->
        <div class="section-card">
            <span class="section-icon">ğŸ‘¥</span>
            <h2 class="section-title">Character Design</h2>
            <div class="section-content">
                <p>Create memorable characters with depth, motivations, and relationships.</p>
                
                <div class="prompt-box">
                    ğŸ’­ What does each character want, and what stops them from getting it?
                </div>
                
                <ul>
                    <li>Backstory - Where they come from and why it matters</li>
                    <li>Motivation - Their goals and desires</li>
                    <li>Personality - Unique traits and quirks</li>
                    <li>Relationships - How they connect to others</li>
                    <li>Character Arc - How they change over time</li>
                </ul>
                
                <div class="example-card">
                    <div class="example-title">Character Template:</div>
                    <div class="example-text">
                        <strong>Name:</strong> Elena the Healer<br>
                        <strong>Wants:</strong> To save her village<br>
                        <strong>Fears:</strong> Losing more people she cares about<br>
                        <strong>Secret:</strong> She was once infected but cured herself
                    </div>
                </div>
            </div>
        </div>

        <!-- Side Quests -->
        <div class="section-card">
            <span class="section-icon">ğŸ¯</span>
            <h2 class="section-title">Side Quests</h2>
            <div class="section-content">
                <p>Optional content that enriches your world and provides variety.</p>
                
                <div class="prompt-box">
                    ğŸ’­ What smaller stories exist within your larger world?
                </div>
                
                <ul>
                    <li>Character Quests - Deepen relationships with NPCs</li>
                    <li>World Building - Reveal lore and history</li>
                    <li>Rewards - Provide useful items or abilities</li>
                    <li class="action-only">Moral Choices - Present ethical dilemmas</li>
                    <li class="cozy-only">Community Building - Help bring people together</li>
                    <li>Variety - Break up the main quest pacing</li>
                </ul>
                
                <div class="example-card action-only">
                    <div class="example-title">Side Quest Ideas:</div>
                    <div class="example-text">
                        â€¢ Help a merchant recover stolen goods<br>
                        â€¢ Investigate strange sounds in the forest<br>
                        â€¢ Settle a dispute between two families<br>
                        â€¢ Find ingredients for a rare potion
                    </div>
                </div>
                
                <div class="example-card cozy-only">
                    <div class="example-title">Side Quest Ideas:</div>
                    <div class="example-text">
                        â€¢ Help a baker perfect their signature recipe<br>
                        â€¢ Document wildlife in the nearby meadow<br>
                        â€¢ Organize a village picnic by the lake<br>
                        â€¢ Collect flowers to decorate the town square
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reflection Prompts -->
    <div class="header-card">
        <h2 style="color: #ffd700; font-size: 2em; margin-bottom: 20px;">ğŸ’¡ Reflection Prompts</h2>
        <div style="text-align: left; max-width: 800px; margin: 0 auto;">
            <div class="prompt-box">
                What is your character afraid of, and how does this fear affect their decisions?
            </div>
            <div class="prompt-box action-only">
                What secret does your villain hide that might make players sympathize with them?
            </div>
            <div class="prompt-box cozy-only">
                What memory or tradition does your character hold most dear?
            </div>
            <div class="prompt-box">
                What will your world look like if the main character fails? What if they succeed?
            </div>
            <div class="prompt-box">
                What sacrifice will your main character have to make to achieve their goal?
            </div>
            <div class="prompt-box action-only">
                How do the cultures and factions in your world conflict with each other?
            </div>
            <div class="prompt-box cozy-only">
                How does your character make the world a little bit better each day?
            </div>
        </div>
    </div>
    
    <!-- World Map Quest Tracker removed - now appears after World Design -->

<script>
// Check for game mode from page 2 (stored in localStorage)
let gameMode = localStorage.getItem('rpgGameMode') || 'action'; // default to action

// Update page content based on mode
window.addEventListener('load', () => {
    updateContentForMode(gameMode);
    displayCurrentMode(gameMode);
});

function displayCurrentMode(mode) {
    const modeDisplay = document.getElementById('current-mode-display');
    if (modeDisplay) {
        const icon = mode === 'cozy' ? 'ğŸŒ¿' : 'âš”ï¸';
        const modeName = mode === 'cozy' ? 'Cozy RPG' : 'Action RPG';
        modeDisplay.innerHTML = `${icon} <strong>Mode:</strong> ${modeName} <span style="font-size: 0.9em; opacity: 0.7;">(selected from previous page)</span>`;
        modeDisplay.style.color = '#ffd700';
        modeDisplay.style.marginTop = '10px';
    }
}

function updateModeSelector(mode) {
    // No longer needed - mode selector removed
}

function updateContentForMode(mode) {
    // Update subtitle
    const subtitle = document.querySelector('.subtitle');
    if (mode === 'cozy') {
        subtitle.textContent = 'Craft Relaxing Story-Rich Adventures';
    } else {
        subtitle.textContent = 'Craft Compelling RPG Adventures';
    }
    
    // Show/hide mode-specific sections
    const cozyElements = document.querySelectorAll('.cozy-only');
    const actionElements = document.querySelectorAll('.action-only');
    
    cozyElements.forEach(el => {
        el.style.display = mode === 'cozy' ? 'block' : 'none';
    });
    
    actionElements.forEach(el => {
        el.style.display = mode === 'action' ? 'block' : 'none';
    });
}

// Character Builder Form Handler
let characterSheetData = null;
let questLogData = [];

document.addEventListener('DOMContentLoaded', () => {
    const characterForm = document.getElementById('character-form');
    if (characterForm) {
        characterForm.addEventListener('submit', handleCharacterSubmit);
    }
    
    const questForm = document.getElementById('quest-form');
    if (questForm) {
        questForm.addEventListener('submit', handleQuestSubmit);
    }
    
    // Load existing quest log
    loadQuestLog();
});

async function handleCharacterSubmit(event) {
    event.preventDefault();
    
    // Get user session data
    const userSession = localStorage.getItem('userSession');
    if (!userSession) {
        alert('Please login first to create characters!');
        window.location.href = '/rpg/login';
        return;
    }
    
    const sessionData = JSON.parse(userSession);
    
    const formData = {
        name: document.getElementById('char-name').value,
        motivation: document.getElementById('char-motivation').value,
        fear: document.getElementById('char-fear').value,
        secret: document.getElementById('char-secret').value,
        gameMode: gameMode,
        userGithubId: sessionData.githubId  // Add user ID
    };
    
    try {
        const response = await fetch('http://localhost:8587/api/rpg/character', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        if (response.ok) {
            const result = await response.json();
            characterSheetData = result;
            displayCharacterSheet(result);
        } else {
            alert('Error creating character sheet. Please try again.');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Could not connect to server. Please make sure the Flask backend is running.');
    }
}

function displayCharacterSheet(data) {
    const resultBox = document.getElementById('character-sheet-result');
    const content = document.getElementById('character-sheet-content');
    
    content.innerHTML = `
        <div style="border: 3px solid #ffd700; border-radius: 15px; padding: 30px; background: rgba(0, 0, 0, 0.6);">
            <h2 style="color: #ffd700; text-align: center; font-size: 2.5em; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 3px;">
                ${data.name}
            </h2>
            <p style="text-align: center; color: #ffed4e; font-style: italic; margin-bottom: 30px; font-size: 1.1em;">
                ${data.gameMode === 'cozy' ? 'ğŸŒ¿ Cozy RPG Character' : 'âš”ï¸ Action RPG Character'}
            </p>
            
            <div style="margin-bottom: 25px; padding: 20px; background: rgba(255, 215, 0, 0.1); border-radius: 10px; border-left: 4px solid #ffd700;">
                <h3 style="color: #ffed4e; margin-bottom: 10px; font-size: 1.3em;">ğŸ’« Motivation</h3>
                <p style="color: #e0e0e0; line-height: 1.8; font-size: 1.1em;">${data.motivation}</p>
            </div>
            
            <div style="margin-bottom: 25px; padding: 20px; background: rgba(255, 215, 0, 0.1); border-radius: 10px; border-left: 4px solid #ffd700;">
                <h3 style="color: #ffed4e; margin-bottom: 10px; font-size: 1.3em;">ğŸ˜° Greatest Fear</h3>
                <p style="color: #e0e0e0; line-height: 1.8; font-size: 1.1em;">${data.fear}</p>
            </div>
            
            <div style="margin-bottom: 25px; padding: 20px; background: rgba(255, 215, 0, 0.1); border-radius: 10px; border-left: 4px solid #ffd700;">
                <h3 style="color: #ffed4e; margin-bottom: 10px; font-size: 1.3em;">ğŸ¤« Hidden Secret</h3>
                <p style="color: #e0e0e0; line-height: 1.8; font-size: 1.1em;">${data.secret}</p>
            </div>
            
            <div style="padding: 20px; background: rgba(255, 215, 0, 0.05); border-radius: 10px; border: 2px dashed #ffd700;">
                <h3 style="color: #ffed4e; margin-bottom: 15px; font-size: 1.3em;">ğŸ“ Character Analysis</h3>
                <p style="color: #c0c0c0; line-height: 1.8; font-size: 1em;">${data.analysis}</p>
            </div>
            
            <p style="text-align: center; color: #888; margin-top: 25px; font-size: 0.9em;">
                Created on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
            </p>
        </div>
    `;
    
    resultBox.classList.add('active');
}

function downloadCharacterSheet() {
    if (!characterSheetData) {
        alert('No character sheet to download!');
        return;
    }
    
    const textContent = `
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    CHARACTER SHEET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

NAME: ${characterSheetData.name}
TYPE: ${characterSheetData.gameMode === 'cozy' ? 'Cozy RPG Character' : 'Action RPG Character'}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MOTIVATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
${characterSheetData.motivation}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
GREATEST FEAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
${characterSheetData.fear}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
HIDDEN SECRET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
${characterSheetData.secret}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CHARACTER ANALYSIS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
${characterSheetData.analysis}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Created on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    `;
    
    const blob = new Blob([textContent], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${characterSheetData.name.replace(/\s+/g, '_')}_CharacterSheet.txt`;
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
}

// Quest Tracker Handler
async function handleQuestSubmit(event) {
    event.preventDefault();
    
    // Get user session data
    const userSession = localStorage.getItem('userSession');
    if (!userSession) {
        alert('Please login first to create quests!');
        window.location.href = '/rpg/login';
        return;
    }
    
    const sessionData = JSON.parse(userSession);
    
    const questData = {
        title: document.getElementById('quest-title').value,
        location: document.getElementById('quest-location').value,
        objective: document.getElementById('quest-objective').value,
        difficulty: document.getElementById('quest-difficulty').value,
        reward: document.getElementById('quest-reward').value,
        gameMode: gameMode,
        userGithubId: sessionData.githubId  // Add user ID
    };
    
    try {
        const response = await fetch('http://localhost:8587/api/rpg/quest', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(questData)
        });
        
        if (response.ok) {
            const result = await response.json();
            questLogData.push(result);
            displayQuestLog();
            event.target.reset();
            alert('âœ… Quest added to your log!');
        } else {
            alert('Error adding quest. Please try again.');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Could not connect to server. Please make sure the Flask backend is running.');
    }
}

async function loadQuestLog() {
    // Get user session data
    const userSession = localStorage.getItem('userSession');
    if (!userSession) {
        return; // Don't load quests if not logged in
    }
    
    const sessionData = JSON.parse(userSession);
    
    try {
        const response = await fetch(`http://localhost:8587/api/rpg/quests?userGithubId=${encodeURIComponent(sessionData.githubId)}`);
        if (response.ok) {
            const result = await response.json();
            questLogData = result.quests || [];
            if (questLogData.length > 0) {
                displayQuestLog();
            }
        }
    } catch (error) {
        console.error('Error loading quest log:', error);
    }
}

function displayQuestLog() {
    const resultBox = document.getElementById('quest-log-result');
    const content = document.getElementById('quest-log-content');
    
    if (questLogData.length === 0) {
        content.innerHTML = '<p style="color: #c0c0c0; text-align: center; font-style: italic;">No quests yet. Add your first quest above!</p>';
        resultBox.classList.add('active');
        return;
    }
    
    const locationIcons = {
        'town': 'ğŸ˜ï¸',
        'dungeon': 'â›ï¸',
        'forest': 'ğŸŒ²',
        'mountain': 'â›°ï¸',
        'castle': 'ğŸ°',
        'cave': 'ğŸ•³ï¸',
        'ocean': 'ğŸŒŠ',
        'desert': 'ğŸœï¸'
    };
    
    const difficultyStars = {
        'easy': 'â­',
        'medium': 'â­â­',
        'hard': 'â­â­â­',
        'epic': 'â­â­â­â­'
    };
    
    let questsHTML = '';
    questLogData.forEach((quest, index) => {
        questsHTML += `
            <div style="margin-bottom: 20px; padding: 20px; background: rgba(255, 215, 0, 0.1); border-radius: 10px; border-left: 4px solid #ffd700;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h3 style="color: #ffd700; margin: 0; font-size: 1.3em;">${locationIcons[quest.location] || 'ğŸ“'} ${quest.title}</h3>
                    <span style="color: #ffed4e; font-size: 0.9em;">#${index + 1}</span>
                </div>
                <p style="color: #ffed4e; margin: 5px 0;"><strong>Location:</strong> ${quest.location.charAt(0).toUpperCase() + quest.location.slice(1)}</p>
                <p style="color: #e0e0e0; margin: 10px 0; line-height: 1.6;"><strong style="color: #ffed4e;">Objective:</strong> ${quest.objective}</p>
                <div style="display: flex; justify-content: space-between; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 215, 0, 0.2);">
                    <span style="color: #c0c0c0;"><strong style="color: #ffed4e;">Difficulty:</strong> ${difficultyStars[quest.difficulty]} ${quest.difficulty.charAt(0).toUpperCase() + quest.difficulty.slice(1)}</span>
                    <span style="color: #c0c0c0;"><strong style="color: #ffed4e;">Reward:</strong> ${quest.reward}</span>
                </div>
            </div>
        `;
    });
    
    content.innerHTML = questsHTML;
    resultBox.classList.add('active');
}

function downloadQuestLog() {
    if (questLogData.length === 0) {
        alert('No quests to download!');
        return;
    }
    
    let textContent = `
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    QUEST LOG - ${gameMode === 'cozy' ? 'COZY RPG' : 'ACTION RPG'}
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Total Quests: ${questLogData.length}

`;
    
    questLogData.forEach((quest, index) => {
        textContent += `
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
QUEST #${index + 1}: ${quest.title}
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Location: ${quest.location.charAt(0).toUpperCase() + quest.location.slice(1)}
Difficulty: ${quest.difficulty.charAt(0).toUpperCase() + quest.difficulty.slice(1)}

Objective:
${quest.objective}

Reward: ${quest.reward}

`;
    });
    
    textContent += `
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Created on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    `;
    
    const blob = new Blob([textContent], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `QuestLog_${new Date().toISOString().split('T')[0]}.txt`;
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
}
</script>   